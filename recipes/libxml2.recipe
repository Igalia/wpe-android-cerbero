# -*- Mode: Python -*- vi:si:et:sw=4:sts=4:ts=4:syntax=python


class Recipe(recipe.Recipe):
    name = 'libxml2'
    version = '2.9.13'
    stype = SourceType.TARBALL
    # Upstream still has a broken SSL certificate, use our mirror
    #url = 'https://xmlsoft.org/sources/libxml2-%(version)s.tar.gz'
    url = 'https://download.gnome.org/sources/libxml2/2.9/libxml2-%(version)s.tar.xz'
    tarball_checksum = '276130602d12fe484ecc03447ee5e759d0465558fbc9d6bd144e3745306ebf0e'
    licenses = [{License.MIT: ['COPYING']}]
    configure_options = '--with-python=no'

    deps = [ 'zlib' ]

    files_libs = ['libxml2']
    files_devel = ['include/libxml2', '%(libdir)s/xml2Conf.sh', 'bin/xml2-config',
                   '%(libdir)s/pkgconfig/libxml-2.0.pc', 'bin/xmllint%(bext)s']

    def prepare(self):
        if self.config.target_platform == Platform.WINDOWS:
            self.configure_options += ' --without-threads'
        elif self.config.target_platform == Platform.ANDROID:
            v = DistroVersion.get_android_api_version(self.config.target_distro_version)
            if v < 21:
                self.append_env('CFLAGS', '-D_FILE_OFFSET_BITS=32')
                self.append_env('CPPFLAGS', '-D_FILE_OFFSET_BITS=32')
